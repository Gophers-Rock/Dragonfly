package {{ .Package }}

import (
	"sync"
)

// HandlerManager manages a {{ .Package }}'s handlers.
type HandlerManager struct {
	sync.Mutex
	handlers []Handler
}

type Handler interface {
	{{ range .Events -}}
	Handle{{ .Name }}(Event{{ .Name }})
	{{ end -}}
}

func (hm *HandlerManager) AddHandler(h Handler) func(Handler) Handler {
	hm.Lock()
	defer hm.Unlock()

	idx := len(hm.handlers)
	hm.handlers = append(hm.handlers, h)

	return func(hNew Handler) Handler {
		hm.Lock()
		defer hm.Unlock()

		if hNew == nil {
			hm.handlers[idx] = NopHandler{}
			return h
		}

		hm.handlers[idx] = hNew
		return h
    	}
}
{{ range .Events }}
func (hm *HandlerManager) Handle{{ .Name }}(e Event{{ .Name }}) {
	hm.Lock()

	for _, h := range hm.handlers {
		h.Handle{{ .Name }}(e)
	}

	hm.Unlock()
}
{{ end }}
type NopHandler struct{}

{{ range .Events -}}
func (NopHandler) Handle{{ .Name}}(Event{{ .Name }}) {}
{{ end }}
